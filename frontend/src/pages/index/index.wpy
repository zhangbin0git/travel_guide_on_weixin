<template>
  <view class="index-page">
    <!-- é¡¶éƒ¨æœç´¢æ  -->
    <view class="search-container">
      <view class="search-box" @tap="goToSearch">
        <text class="search-icon">ğŸ”</text>
        <text class="search-placeholder">æœç´¢ç›®çš„åœ°ã€æ”»ç•¥</text>
      </view>
    </view>
    
    <!-- è½®æ’­å›¾ -->
    <view class="banner-container">
      <swiper 
        class="banner-swiper" 
        indicator-dots 
        autoplay 
        circular 
        interval="3000"
        indicator-color="rgba(255,255,255,0.5)"
        indicator-active-color="#ffffff"
      >
        <swiper-item 
          v-for="(item, index) in bannerList" 
          :key="index"
          @tap="onBannerTap(item)"
        >
          <image 
            class="banner-image" 
            :src="item.imageUrl" 
            mode="aspectFill"
          />
          <view class="banner-content">
            <text class="banner-title">{{ item.title }}</text>
            <text class="banner-subtitle">{{ item.subtitle }}</text>
          </view>
        </swiper-item>
      </swiper>
    </view>
    
    <!-- åŠŸèƒ½å…¥å£ -->
    <view class="feature-container">
      <view 
        class="feature-item" 
        v-for="(item, index) in featureList" 
        :key="index"
        @tap="onFeatureTap(item)"
      >
        <view class="feature-icon">
          <text>{{ item.icon }}</text>
        </view>
        <text class="feature-title">{{ item.title }}</text>
      </view>
    </view>
    
    <!-- çƒ­é—¨æ”»ç•¥ -->
    <view class="section-container">
      <view class="section-header">
        <text class="section-title">çƒ­é—¨æ”»ç•¥</text>
        <text class="section-more" @tap="goToGuideList">æŸ¥çœ‹æ›´å¤š</text>
      </view>
      <view class="guide-list">
        <view 
          class="guide-item" 
          v-for="(item, index) in guideList" 
          :key="index"
          @tap="goToGuideDetail(item.id)"
        >
          <image 
            class="guide-image" 
            :src="item.coverImage" 
            mode="aspectFill"
          />
          <view class="guide-content">
            <text class="guide-title">{{ item.title }}</text>
            <text class="guide-desc">{{ item.description }}</text>
            <view class="guide-meta">
              <text class="guide-destination">{{ item.destination }}</text>
              <text class="guide-days">{{ item.days }}å¤©</text>
            </view>
          </view>
        </view>
      </view>
    </view>
    
    <!-- æ¨èç›®çš„åœ° -->
    <view class="section-container">
      <view class="section-header">
        <text class="section-title">æ¨èç›®çš„åœ°</text>
        <text class="section-more" @tap="goToDestinationList">æŸ¥çœ‹æ›´å¤š</text>
      </view>
      <view class="destination-grid">
        <view 
          class="destination-item" 
          v-for="(item, index) in destinationList" 
          :key="index"
          @tap="goToDestinationDetail(item.id)"
        >
          <image 
            class="destination-image" 
            :src="item.coverImage" 
            mode="aspectFill"
          />
          <view class="destination-overlay">
            <text class="destination-name">{{ item.name }}</text>
            <text class="destination-desc">{{ item.description }}</text>
          </view>
        </view>
      </view>
    </view>
  </view>
</template>

<script lang="ts">
import wepy from '@wepy/core';

wepy.page({
  data: {
    bannerList: [
      {
        id: 1,
        title: 'æ˜¥æ—¥èµèŠ±',
        subtitle: 'æ¢ç´¢æœ€ç¾èŠ±æµ·',
        imageUrl: 'https://picsum.photos/seed/banner1/750/300.jpg',
        link: ''
      },
      {
        id: 2,
        title: 'æµ·å²›åº¦å‡',
        subtitle: 'äº«å—é˜³å…‰æ²™æ»©',
        imageUrl: 'https://picsum.photos/seed/banner2/750/300.jpg',
        link: ''
      },
      {
        id: 3,
        title: 'å¤é•‡æ¼«æ­¥',
        subtitle: 'æ„Ÿå—å†å²æ–‡åŒ–',
        imageUrl: 'https://picsum.photos/seed/banner3/750/300.jpg',
        link: ''
      }
    ],
    featureList: [
      {
        id: 1,
        title: 'æ™ºèƒ½æ”»ç•¥',
        icon: 'ğŸ§­',
        path: '/pages/generate/index'
      },
      {
        id: 2,
        title: 'æ™¯ç‚¹æ¨è',
        icon: 'ğŸï¸',
        path: '/pages/attractions/index'
      },
      {
        id: 3,
        title: 'ç¾é£Ÿæ¢ç´¢',
        icon: 'ğŸœ',
        path: '/pages/food/index'
      },
      {
        id: 4,
        title: 'è¡Œç¨‹è§„åˆ’',
        icon: 'ğŸ“…',
        path: '/pages/plan/index'
      }
    ],
    guideList: [
      {
        id: 1,
        title: 'åŒ—äº¬ä¸‰æ—¥æ¸¸å®Œç¾æ”»ç•¥',
        description: 'æ•…å®«ã€é•¿åŸã€é¢å’Œå›­ä¸€ç½‘æ‰“å°½',
        coverImage: 'https://picsum.photos/seed/guide1/200/150.jpg',
        destination: 'åŒ—äº¬',
        days: 3
      },
      {
        id: 2,
        title: 'ä¸Šæµ·å‘¨æœ«æ¸¸æŒ‡å—',
        description: 'å¤–æ»©ã€è¿ªå£«å°¼ã€åŸéšåº™å¿…æ‰“å¡',
        coverImage: 'https://picsum.photos/seed/guide2/200/150.jpg',
        destination: 'ä¸Šæµ·',
        days: 2
      },
      {
        id: 3,
        title: 'æˆéƒ½ç¾é£Ÿä¹‹æ—…',
        description: 'ç«é”…ã€ä¸²ä¸²ã€å°åƒåƒåˆ°çˆ½',
        coverImage: 'https://picsum.photos/seed/guide3/200/150.jpg',
        destination: 'æˆéƒ½',
        days: 4
      }
    ],
    destinationList: [
      {
        id: 1,
        name: 'æ­å·',
        description: 'äººé—´å¤©å ‚',
        coverImage: 'https://picsum.photos/seed/dest1/350/200.jpg'
      },
      {
        id: 2,
        name: 'è¥¿å®‰',
        description: 'åƒå¹´å¤éƒ½',
        coverImage: 'https://picsum.photos/seed/dest2/350/200.jpg'
      },
      {
        id: 3,
        name: 'å¦é—¨',
        description: 'æµ·ä¸ŠèŠ±å›­',
        coverImage: 'https://picsum.photos/seed/dest3/350/200.jpg'
      },
      {
        id: 4,
        name: 'ä¸½æ±Ÿ',
        description: 'æµªæ¼«å¤åŸ',
        coverImage: 'https://picsum.photos/seed/dest4/350/200.jpg'
      }
    ]
  },
  
  onLoad() {
    this.loadPageData();
  },
  
  onShow() {
    // é¡µé¢æ˜¾ç¤ºæ—¶åˆ·æ–°æ•°æ®
  },
  
  onPullDownRefresh() {
    this.loadPageData().then(() => {
      wx.stopPullDownRefresh();
    });
  },
  
  onReachBottom() {
    // åŠ è½½æ›´å¤šæ•°æ®
  },
  
  methods: {
    /**
     * åŠ è½½é¡µé¢æ•°æ®
     */
    async loadPageData() {
      try {
        // è¿™é‡Œå¯ä»¥è°ƒç”¨APIè·å–æ•°æ®
        // const res = await api.getHomeData();
        // this.bannerList = res.data.banners;
        // this.guideList = res.data.guides;
        // this.destinationList = res.data.destinations;
      } catch (error) {
        console.error('åŠ è½½é¡µé¢æ•°æ®å¤±è´¥:', error);
      }
    },
    
    /**
     * è½®æ’­å›¾ç‚¹å‡»
     */
    onBannerTap(item: any) {
      if (item.link) {
        wx.navigateTo({
          url: item.link
        });
      }
    },
    
    /**
     * åŠŸèƒ½å…¥å£ç‚¹å‡»
     */
    onFeatureTap(item: any) {
      wx.navigateTo({
        url: item.path
      });
    },
    
    /**
     * è·³è½¬åˆ°æœç´¢é¡µ
     */
    goToSearch() {
      wx.navigateTo({
        url: '/pages/search/index'
      });
    },
    
    /**
     * è·³è½¬åˆ°æ”»ç•¥åˆ—è¡¨
     */
    goToGuideList() {
      wx.navigateTo({
        url: '/pages/guide-list/index'
      });
    },
    
    /**
     * è·³è½¬åˆ°æ”»ç•¥è¯¦æƒ…
     */
    goToGuideDetail(id: number) {
      wx.navigateTo({
        url: `/pages/guide-detail/index?id=${id}`
      });
    },
    
    /**
     * è·³è½¬åˆ°ç›®çš„åœ°åˆ—è¡¨
     */
    goToDestinationList() {
      wx.navigateTo({
        url: '/pages/destination-list/index'
      });
    },
    
    /**
     * è·³è½¬åˆ°ç›®çš„åœ°è¯¦æƒ…
     */
    goToDestinationDetail(id: number) {
      wx.navigateTo({
        url: `/pages/destination-detail/index?id=${id}`
      });
    }
  }
});
</script>

<style lang="scss" src="@/assets/styles/index.scss" />

<style lang="scss">
.index-page {
  min-height: 100vh;
  background-color: #f5f5f5;
}

.search-container {
  padding: 20rpx;
  background-color: #ffffff;
  
  .search-box {
    display: flex;
    align-items: center;
    height: 72rpx;
    padding: 0 24rpx;
    background-color: #f5f5f5;
    border-radius: 36rpx;
    
    .search-icon {
      margin-right: 16rpx;
      font-size: 32rpx;
      color: #999;
    }
    
    .search-placeholder {
      font-size: 28rpx;
      color: #999;
    }
  }
}

.banner-container {
  height: 300rpx;
  margin-bottom: 20rpx;
  
  .banner-swiper {
    height: 100%;
  }
  
  .banner-image {
    width: 100%;
    height: 100%;
  }
  
  .banner-content {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    padding: 30rpx;
    background: linear-gradient(transparent, rgba(0, 0, 0, 0.6));
    
    .banner-title {
      display: block;
      font-size: 32rpx;
      font-weight: bold;
      color: #ffffff;
      margin-bottom: 8rpx;
    }
    
    .banner-subtitle {
      font-size: 24rpx;
      color: rgba(255, 255, 255, 0.8);
    }
  }
}

.feature-container {
  display: flex;
  justify-content: space-around;
  padding: 30rpx 20rpx;
  background-color: #ffffff;
  margin-bottom: 20rpx;
  
  .feature-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    
    .feature-icon {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 80rpx;
      height: 80rpx;
      margin-bottom: 16rpx;
      border-radius: 50%;
      background-color: rgba(0, 122, 255, 0.1);
      
      text {
        font-size: 40rpx;
      }
    }
    
    .feature-title {
      font-size: 24rpx;
      color: #333;
    }
  }
}

.section-container {
  margin-bottom: 20rpx;
  
  .section-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 20rpx;
    
    .section-title {
      font-size: 32rpx;
      font-weight: bold;
      color: #333;
    }
    
    .section-more {
      font-size: 24rpx;
      color: #007aff;
    }
  }
}

.guide-list {
  padding: 0 20rpx;
  
  .guide-item {
    display: flex;
    margin-bottom: 20rpx;
    padding: 20rpx;
    background-color: #ffffff;
    border-radius: 16rpx;
    box-shadow: 0 2rpx 8rpx rgba(0, 0, 0, 0.1);
    
    .guide-image {
      width: 200rpx;
      height: 150rpx;
      margin-right: 20rpx;
      border-radius: 12rpx;
    }
    
    .guide-content {
      flex: 1;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      
      .guide-title {
        font-size: 28rpx;
        font-weight: bold;
        color: #333;
        margin-bottom: 8rpx;
      }
      
      .guide-desc {
        font-size: 24rpx;
        color: #666;
        margin-bottom: 16rpx;
      }
      
      .guide-meta {
        display: flex;
        justify-content: space-between;
        
        .guide-destination {
          font-size: 24rpx;
          color: #007aff;
        }
        
        .guide-days {
          font-size: 24rpx;
          color: #999;
        }
      }
    }
  }
}

.destination-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 20rpx;
  padding: 0 20rpx;
  
  .destination-item {
    position: relative;
    height: 200rpx;
    border-radius: 16rpx;
    overflow: hidden;
    
    .destination-image {
      width: 100%;
      height: 100%;
    }
    
    .destination-overlay {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      padding: 20rpx;
      background: linear-gradient(transparent, rgba(0, 0, 0, 0.6));
      
      .destination-name {
        display: block;
        font-size: 28rpx;
        font-weight: bold;
        color: #ffffff;
        margin-bottom: 4rpx;
      }
      
      .destination-desc {
        font-size: 22rpx;
        color: rgba(255, 255, 255, 0.8);
      }
    }
  }
}
</style>