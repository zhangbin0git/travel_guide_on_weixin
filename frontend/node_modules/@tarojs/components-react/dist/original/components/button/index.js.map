{"version":3,"file":"index.js","sources":["../../../../src/components/button/index.tsx"],"sourcesContent":["import './style/index.scss'\n\nimport { View } from '@tarojs/components'\nimport classNames from 'classnames'\n\nimport { createForwardRefComponent, omit } from '../../utils'\nimport { useCallback, useEffect, useRef, useState } from '../../utils/hooks'\n\nimport type React from 'react'\n\ninterface IProps extends Omit<React.ButtonHTMLAttributes<HTMLButtonElement>, 'type'> {\n  size?: string\n  plain?: boolean\n  hoverClass?: string\n  hoverStartTime?: number\n  hoverStayTime?: number\n  disabled?: boolean\n  loading?: boolean\n  type?: string\n  className?: string\n  forwardedRef?: React.MutableRefObject<HTMLButtonElement>\n  onClick?: (e: React.MouseEvent<HTMLButtonElement>) => void\n  formType?: 'submit' | 'reset'\n}\n\ninterface IState {\n  hover: boolean\n  touch: boolean\n}\n\nfunction Button (props: IProps) {\n  const startTimer = useRef<ReturnType<typeof setTimeout>>()\n  const endTimer = useRef<ReturnType<typeof setTimeout>>()\n  const [state, setState] = useState<IState>({\n    hover: false,\n    touch: false\n  })\n\n  useEffect(() => {\n    return () => {\n      startTimer.current && clearTimeout(startTimer.current)\n      endTimer.current && clearTimeout(endTimer.current)\n    }\n  }, [])\n\n  const _onTouchStart = (e: React.TouchEvent<HTMLButtonElement>) => {\n    setState((e) => ({\n      ...e,\n      touch: true\n    }))\n    if (props.hoverClass && props.hoverClass !== 'none' && !props.disabled) {\n      startTimer.current = setTimeout(() => {\n        if ((state as IState).touch) {\n          setState((e) => ({\n            ...e,\n            hover: true\n          }))\n        }\n      }, props.hoverStartTime || 20)\n    }\n    props.onTouchStart && props.onTouchStart(e)\n  }\n\n  const _onTouchEnd = (e: React.TouchEvent<HTMLButtonElement>) => {\n    setState((e) => ({\n      ...e,\n      touch: false\n    }))\n    if (props.hoverClass && props.hoverClass !== 'none' && !props.disabled) {\n      endTimer.current = setTimeout(() => {\n        if (!(state as IState).touch) {\n          setState((e) => ({\n            ...e,\n            hover: false\n          }))\n        }\n      }, props.hoverStayTime || 70)\n    }\n\n    if (!props.disabled && props.formType) {\n      const eventName = props.formType === 'submit' ? 'tarobuttonsubmit' : 'tarobuttonreset'\n      e.currentTarget.dispatchEvent(new CustomEvent(eventName, { bubbles: true }))\n    }\n\n    props.onTouchEnd && props.onTouchEnd(e)\n  }\n\n  const { forwardedRef, plain = false, children, disabled = false, className, style, onClick, hoverClass = 'button-hover', loading = false, type = 'default', size, formType, ...restProps } = props\n\n  const handleClick = useCallback(\n    (e: React.MouseEvent<HTMLButtonElement>) => {\n      if (disabled) {\n        // 按钮禁用时阻止事件冒泡并不触发点击回调\n        e.stopPropagation()\n        return\n      }\n      // 按钮可用时触发点击回调\n      onClick?.(e)\n    },\n    [disabled, onClick]\n  )\n\n  const cls = classNames(\n    className,\n    'taro-button-core',\n    {\n      [`${hoverClass}`]: (state as IState).hover && !disabled,\n      'taro-btn-disabled': disabled,\n      'taro-btn-loading': loading,\n      'taro-btn-plain': plain,\n      'taro-btn-mini': size === 'mini',\n      'taro-btn-default': type === 'default',\n      'taro-btn-primary': type === 'primary',\n      'taro-btn-warn': type === 'warn'\n    }\n  )\n\n  return (\n    <View\n      {...omit(restProps, ['hoverClass', 'onTouchStart', 'onTouchEnd', 'type', 'loading', 'forwardedRef', 'size', 'plain', 'disabled', 'onClick', 'formType'])}\n      type={type}\n      size={size}\n      disabled={disabled}\n      ref={forwardedRef}\n      className={cls}\n      style={style}\n      onClick={handleClick}\n      onTouchStart={_onTouchStart}\n      onTouchEnd={_onTouchEnd}\n      plain={plain.toString()}\n      form-type={formType as any}\n    >\n      {!!loading && <View className='weui-loading' />}\n      {children}\n    </View>\n  )\n}\n\nexport default createForwardRefComponent(Button)\n"],"names":["Button","props","startTimer","useRef","endTimer","state","setState","useState","hover","touch","useEffect","current","clearTimeout","_onTouchStart","e","Object","assign","hoverClass","disabled","setTimeout","hoverStartTime","onTouchStart","_onTouchEnd","hoverStayTime","formType","eventName","currentTarget","dispatchEvent","CustomEvent","bubbles","onTouchEnd","forwardedRef","plain","children","className","style","onClick","loading","type","size","restProps","__rest","handleClick","useCallback","stopPropagation","cls","classNames","_jsxs","View","omit","ref","toString","_jsx","createForwardRefComponent"],"mappings":"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"}